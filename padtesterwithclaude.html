<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gamepad Button Debugger</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #00ff00;
            text-shadow: 0 0 10px #00ff00;
        }
        .status {
            background: #000;
            border: 2px solid #00ff00;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .button-info {
            background: #000;
            border: 2px solid #333;
            padding: 10px;
            border-radius: 5px;
            transition: all 0.1s;
        }
        .button-info.active {
            border-color: #00ff00;
            background: #003300;
            box-shadow: 0 0 20px #00ff00;
        }
        .button-name {
            font-weight: bold;
            color: #ffff00;
            margin-bottom: 5px;
        }
        .button-value {
            font-size: 0.9em;
        }
        .axes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        .axis-info {
            background: #000;
            border: 2px solid #333;
            padding: 10px;
            border-radius: 5px;
        }
        .axis-bar {
            width: 100%;
            height: 20px;
            background: #333;
            position: relative;
            margin-top: 5px;
            border-radius: 3px;
            overflow: hidden;
        }
        .axis-fill {
            height: 100%;
            background: #00ff00;
            transition: width 0.1s;
            position: absolute;
        }
        .combo-test {
            background: #000;
            border: 2px solid #ff00ff;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
        }
        .combo-test h2 {
            color: #ff00ff;
            margin-top: 0;
        }
        .combo-result {
            font-size: 1.2em;
            color: #ffff00;
            margin-top: 10px;
        }
        .highlight {
            color: #ff0000;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ® Gamepad Button Debugger</h1>
        
        <div class="status">
            <div><strong>æ¥ç¶šçŠ¶æ…‹:</strong> <span id="connection-status">ã‚²ãƒ¼ãƒ ãƒ‘ãƒƒãƒ‰ã‚’æ¥ç¶šã—ã¦ãã ã•ã„</span></div>
            <div><strong>ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å:</strong> <span id="gamepad-name">-</span></div>
            <div><strong>ãƒœã‚¿ãƒ³æ•°:</strong> <span id="button-count">-</span></div>
            <div><strong>è»¸æ•°:</strong> <span id="axes-count">-</span></div>
        </div>

        <h2>ãƒœã‚¿ãƒ³çŠ¶æ…‹</h2>
        <div class="button-grid" id="buttons-container"></div>

        <h2>ã‚¢ãƒŠãƒ­ã‚°ã‚¹ãƒ†ã‚£ãƒƒã‚¯ / è»¸</h2>
        <div class="axes-grid" id="axes-container"></div>

        <div class="combo-test">
            <h2>R2 + åå­—ã‚­ãƒ¼ ã‚³ãƒ³ãƒœãƒ†ã‚¹ãƒˆ</h2>
            <div>
                <strong>R2ãƒœã‚¿ãƒ³ (Index 7):</strong>
                <div id="r2-status">å¾…æ©Ÿä¸­...</div>
            </div>
            <div style="margin-top: 10px;">
                <strong>åå­—ã‚­ãƒ¼çŠ¶æ…‹:</strong>
                <div id="dpad-status">å¾…æ©Ÿä¸­...</div>
            </div>
            <div class="combo-result" id="combo-result">
                R2ã‚’æŠ¼ã—ãªãŒã‚‰åå­—ã‚­ãƒ¼ã‚’æ“ä½œã—ã¦ãã ã•ã„
            </div>
        </div>
    </div>

    <script>
        let activeGamepad = null;
        const DEADZONE = 0.2;

        // ãƒœã‚¿ãƒ³åã®ãƒãƒƒãƒ”ãƒ³ã‚°
        const buttonNames = {
            0: 'A (South)',
            1: 'B (East)',
            2: 'X (West)',
            3: 'Y (North)',
            4: 'L1 (LB)',
            5: 'R1 (RB)',
            6: 'L2 (LT)',
            7: 'R2 (RT)',
            8: 'Select',
            9: 'Start',
            10: 'L3 (Left Stick)',
            11: 'R3 (Right Stick)',
            12: 'D-Pad Up',
            13: 'D-Pad Down',
            14: 'D-Pad Left',
            15: 'D-Pad Right',
            16: 'Home/Guide'
        };

        window.addEventListener('gamepadconnected', (e) => {
            console.log('Gamepad connected:', e.gamepad);
            activeGamepad = e.gamepad;
            document.getElementById('connection-status').textContent = 'âœ“ æ¥ç¶šæ¸ˆã¿';
            document.getElementById('gamepad-name').textContent = e.gamepad.id;
            document.getElementById('button-count').textContent = e.gamepad.buttons.length;
            document.getElementById('axes-count').textContent = e.gamepad.axes.length;
            
            initializeUI(e.gamepad);
        });

        window.addEventListener('gamepaddisconnected', (e) => {
            console.log('Gamepad disconnected:', e.gamepad);
            activeGamepad = null;
            document.getElementById('connection-status').textContent = 'âœ— åˆ‡æ–­ã•ã‚Œã¾ã—ãŸ';
        });

        function initializeUI(gamepad) {
            // ãƒœã‚¿ãƒ³ç”¨UI
            const buttonsContainer = document.getElementById('buttons-container');
            buttonsContainer.innerHTML = '';
            for (let i = 0; i < gamepad.buttons.length; i++) {
                const div = document.createElement('div');
                div.className = 'button-info';
                div.id = `button-${i}`;
                div.innerHTML = `
                    <div class="button-name">${buttonNames[i] || `Button ${i}`}</div>
                    <div class="button-value">
                        <div>Index: ${i}</div>
                        <div>Pressed: <span id="btn-pressed-${i}">false</span></div>
                        <div>Value: <span id="btn-value-${i}">0.00</span></div>
                    </div>
                `;
                buttonsContainer.appendChild(div);
            }

            // è»¸ç”¨UI
            const axesContainer = document.getElementById('axes-container');
            axesContainer.innerHTML = '';
            const axisNames = ['Left Stick X', 'Left Stick Y', 'Right Stick X', 'Right Stick Y'];
            for (let i = 0; i < gamepad.axes.length; i++) {
                const div = document.createElement('div');
                div.className = 'axis-info';
                div.innerHTML = `
                    <div class="button-name">${axisNames[i] || `Axis ${i}`}</div>
                    <div>Value: <span id="axis-value-${i}">0.00</span></div>
                    <div class="axis-bar">
                        <div class="axis-fill" id="axis-bar-${i}"></div>
                    </div>
                `;
                axesContainer.appendChild(div);
            }
        }

        function updateGamepadState() {
            const gamepads = navigator.getGamepads();
            if (!gamepads) return;

            let gp = null;
            for (let i = 0; i < gamepads.length; i++) {
                if (gamepads[i] && gamepads[i].connected) {
                    gp = gamepads[i];
                    if (!activeGamepad) {
                        activeGamepad = gp;
                        document.getElementById('connection-status').textContent = 'âœ“ æ¥ç¶šæ¸ˆã¿';
                        document.getElementById('gamepad-name').textContent = gp.id;
                        document.getElementById('button-count').textContent = gp.buttons.length;
                        document.getElementById('axes-count').textContent = gp.axes.length;
                        initializeUI(gp);
                    }
                    break;
                }
            }

            if (!gp) return;

            // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
            for (let i = 0; i < gp.buttons.length; i++) {
                const button = gp.buttons[i];
                const buttonDiv = document.getElementById(`button-${i}`);
                if (buttonDiv) {
                    const pressed = button.pressed || button.value > 0.3;
                    buttonDiv.classList.toggle('active', pressed);
                    document.getElementById(`btn-pressed-${i}`).textContent = button.pressed;
                    document.getElementById(`btn-value-${i}`).textContent = button.value.toFixed(2);
                }
            }

            // è»¸çŠ¶æ…‹æ›´æ–°
            for (let i = 0; i < gp.axes.length; i++) {
                const value = gp.axes[i];
                const valueSpan = document.getElementById(`axis-value-${i}`);
                const bar = document.getElementById(`axis-bar-${i}`);
                if (valueSpan) {
                    valueSpan.textContent = value.toFixed(2);
                }
                if (bar) {
                    const percent = ((value + 1) / 2) * 100;
                    bar.style.width = percent + '%';
                }
            }

            // R2 + åå­—ã‚­ãƒ¼ ã‚³ãƒ³ãƒœãƒ†ã‚¹ãƒˆ
            updateComboTest(gp);
        }

        function updateComboTest(gp) {
            const r2Button = gp.buttons[7];
            const r2Pressed = r2Button && r2Button.pressed;
            const r2Value = r2Button ? r2Button.value : 0;
            const r2Active = r2Pressed || r2Value > 0.3;

            // R2çŠ¶æ…‹è¡¨ç¤º
            const r2Status = document.getElementById('r2-status');
            r2Status.innerHTML = `
                <div>pressed: <span class="${r2Pressed ? 'highlight' : ''}">${r2Pressed}</span></div>
                <div>value: <span class="${r2Value > 0.3 ? 'highlight' : ''}">${r2Value.toFixed(2)}</span></div>
                <div>åˆ¤å®š: <span class="${r2Active ? 'highlight' : ''}">${r2Active ? 'æŠ¼ã•ã‚Œã¦ã„ã‚‹' : 'æŠ¼ã•ã‚Œã¦ã„ãªã„'}</span></div>
            `;

            // åå­—ã‚­ãƒ¼çŠ¶æ…‹
            const dpadUp = gp.buttons[12] && gp.buttons[12].pressed;
            const dpadDown = gp.buttons[13] && gp.buttons[13].pressed;
            const dpadLeft = gp.buttons[14] && gp.buttons[14].pressed;
            const dpadRight = gp.buttons[15] && gp.buttons[15].pressed;

            const dpadStatus = document.getElementById('dpad-status');
            dpadStatus.innerHTML = `
                ä¸Š: ${dpadUp ? 'âœ“' : '-'} | 
                ä¸‹: ${dpadDown ? 'âœ“' : '-'} | 
                å·¦: ${dpadLeft ? 'âœ“' : '-'} | 
                å³: ${dpadRight ? 'âœ“' : '-'}
            `;

            // ã‚³ãƒ³ãƒœåˆ¤å®š
            const comboResult = document.getElementById('combo-result');
            if (r2Active && (dpadUp || dpadDown || dpadLeft || dpadRight)) {
                const direction = dpadUp ? 'ä¸Š' : dpadDown ? 'ä¸‹' : dpadLeft ? 'å·¦' : 'å³';
                comboResult.textContent = `âœ“ ã‚³ãƒ³ãƒœæˆåŠŸï¼ R2 + åå­—ã‚­ãƒ¼${direction}`;
                comboResult.style.color = '#00ff00';
            } else if (r2Active) {
                comboResult.textContent = 'R2ãŒæŠ¼ã•ã‚Œã¦ã„ã¾ã™ - åå­—ã‚­ãƒ¼ã‚’æ“ä½œã—ã¦ãã ã•ã„';
                comboResult.style.color = '#ffff00';
            } else if (dpadUp || dpadDown || dpadLeft || dpadRight) {
                comboResult.textContent = 'åå­—ã‚­ãƒ¼ãŒæŠ¼ã•ã‚Œã¦ã„ã¾ã™ - R2ã‚’æŠ¼ã—ã¦ãã ã•ã„';
                comboResult.style.color = '#ffff00';
            } else {
                comboResult.textContent = 'R2ã‚’æŠ¼ã—ãªãŒã‚‰åå­—ã‚­ãƒ¼ã‚’æ“ä½œã—ã¦ãã ã•ã„';
                comboResult.style.color = '#999';
            }
        }

        // ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ—
        function gameLoop() {
            updateGamepadState();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>